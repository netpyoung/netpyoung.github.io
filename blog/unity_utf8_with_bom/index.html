<!DOCTYPE html>

<!-- ref: https://bulma.io/ -->
<!-- ref: https://fontawesome.com/icons -->
<!-- ref: https://flagicons.lipis.dev/ -->
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>넷평 남짓한 공간</title>

  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/favicon.ico" type="image/x-icon">
  <link rel="alternate" type="application/atom+xml" title="Atom" href="&#x2F;feed" />
  <link rel="stylesheet" href="/main.css" />

  <!-- #region: Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-855BJNV9VD"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-855BJNV9VD');
  </script>
  <!-- #endregion: Google tag (gtag.js) -->

  <script defer src="/main.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
  <script>mermaid.initialize({ startOnLoad: true });</script>
</head>

<body class="layout-documentation page-layout">
  <div class="container">
    <nav class="navbar is-transparent is-centered has-shadow is-spaced">
      <!-- <div class="container"> -->
      <div class="navbar-brand">
        <a class="navbar-item" href="&#x2F;">
          <i class="fa-solid fa-home"></i>
          <b>넷평 남짓한 공간</b>
        </a>

        <div class="navbar-burger burger" data-target="navbarExampleTransparentExample">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </div><!-- navbar-brand -->
      <!-- </div> -->

      <div id="navbarExampleTransparentExample" class="navbar-menu">
        <div class="navbar-start">
          <a class="navbar-item has-background-grey-lighter"
            href="&#x2F;blog">
            <i class="fa-solid fa-mug-saucer"></i>
          </a>
          <a class="navbar-item "
            href="&#x2F;study">
            <i class="fa-solid fa-pen-to-square"></i>
          </a>
          <a class="navbar-item "
            href="&#x2F;external">
            <i class="fa-solid fa-external-link-alt"></i>
          </a>
          <a class="navbar-item "
            href="&#x2F;diary">
            <i class="fa-solid fa-book"></i>
          </a>
          <a class="navbar-item" href="https:&#x2F;&#x2F;github.com&#x2F;netpyoung">
            <i class="fa-brands fa-github"></i>
          </a>
          <a class="navbar-item" href="/feed.xml">
            <i class="fa-solid fa-rss-square"></i>
          </a>
        </div> <!-- navbar-start -->

        <div class="navbar-end">
          <div class="dropdown ">
            <div class="dropdown-trigger">
              <button class="button" aria-haspopup="true" aria-controls="dropdown-menu">
                <span>connect</span>
                <span class="icon is-small">
                  <i class="fa-solid fa-angle-down" aria-hidden="true"></i>
                </span>
              </button>
            </div>
            <div class="dropdown-menu" id="dropdown-menu" role="menu">
              <div class="dropdown-content">
                <a class="dropdown-item" href="https:&#x2F;&#x2F;facebook.com&#x2F;netpyoung">
                  <span class="icon">
                    <i class="fa-brands fa-facebook"></i>
                  </span>
                  facebook
                </a>
              </div>
            </div>
          </div>
        </div> <!-- navbar-end -->
      </div> <!-- navbar-menu -->
    </nav>

    <div class="content container is-fluid">
      
<h1 class="title">
  Unity UTF8 with BOM
</h1>


  <p class="subtitle"><strong>2013.07.04</strong></p>


<div class="post">
  <h2 id="bomiran">BOM이란?</h2>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Byte_order_mark">https://en.wikipedia.org/wiki/Byte_order_mark</a></li>
<li>BOM이란 byte order mark의 약자로, 파일 혹은 스트림의 바이트 순서(엔디안)을 나타내기 위해 사용되는 Unicode 문자.</li>
</ul>
<h2 id="utf-8yi-bomeun">UTF-8의 BOM은?</h2>
<ul>
<li><code>EF BB BF</code></li>
</ul>
<h2 id="munjeneun">문제는?</h2>
<ul>
<li>UTF8자체가 엔디안 문제가 생기지 않음. 즉 UTF8에는 BOM이 필요없다는 것.</li>
<li>Unity에서 기본으로 소스코드를 생성하면 UTF8 without BOM문서가 나옴.</li>
<li>근데, 뻐킹 유니티에서는 BOM이 없으면 코드를 이상하게 읽음. (한글 포함시)</li>
<li>tip) 꼭 한글 주석 달고 마침표로 끝을 알려주자.</li>
</ul>
<h2 id="haegyeolcaegeun">해결책은?</h2>
<ul>
<li>Unity에는 AssetPostprocessor란 클래스가 있고, OnPostprocessAllAssets란 메소드가 있는데, 이를 이용하면 파일 생성시 마다 BOM을 추가시켜줄 수 있다.</li>
</ul>
<h1 id="inspired">inspired</h1>
<ul>
<li><a href="http://debuglog.tumblr.com/post/26550984743/utf-8">http://debuglog.tumblr.com/post/26550984743/utf-8</a></li>
<li><a href="https://github.com/sharkattack51/Unity-EditorScript/blob/master/AssetPostprocessUTF8Encode.cs">https://github.com/sharkattack51/Unity-EditorScript/blob/master/AssetPostprocessUTF8Encode.cs</a></li>
</ul>
<h2 id="example-source">example source</h2>
<p>SimpleUtf8BOM.boo</p>
<pre data-lang="ruby" style="background-color:#2b303b;color:#c0c5ce;" class="language-ruby "><code class="language-ruby" data-lang="ruby"><span>import </span><span style="color:#bf616a;">UnityEngine
</span><span>
</span><span>import </span><span style="color:#ebcb8b;">System</span><span>.IO
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">SimpleUtf8BOM </span><span>(</span><span style="color:#bf616a;">AssetPostprocessor</span><span>):
</span><span>
</span><span>	static </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">OnPostprocessAllAssets</span><span>(
</span><span>		</span><span style="color:#bf616a;">imported_assets        as </span><span>(</span><span style="color:#bf616a;">string</span><span>),
</span><span>		</span><span style="color:#bf616a;">deleted_assets         as </span><span>(</span><span style="color:#bf616a;">string</span><span>),
</span><span>		</span><span style="color:#bf616a;">moved_assets           as </span><span>(</span><span style="color:#bf616a;">string</span><span>),
</span><span>		</span><span style="color:#bf616a;">moved_from_asset_paths as </span><span>(</span><span style="color:#bf616a;">string</span><span>)) :
</span><span>
</span><span>		</span><span style="color:#b48ead;">for</span><span> asset </span><span style="color:#b48ead;">in</span><span> imported_assets :
</span><span>			checkAndWriteBOM(asset)
</span><span>
</span><span>
</span><span>	static </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">checkAndWriteBOM</span><span>(</span><span style="color:#bf616a;">fpath as string</span><span>) :
</span><span>		</span><span style="color:#65737e;"># check: is source file?
</span><span>		ext = </span><span style="color:#ebcb8b;">Path</span><span>.GetExtension(fpath)
</span><span>		</span><span style="color:#b48ead;">unless </span><span>([&#39;</span><span style="color:#a3be8c;">.cs</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">.js</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">.boo</span><span>&#39;]).Contains(ext) :
</span><span>			</span><span style="color:#b48ead;">return</span><span>;
</span><span>
</span><span>		</span><span style="color:#65737e;"># check: is with bom_utf8?
</span><span>		fbytes = </span><span style="color:#ebcb8b;">File</span><span>.ReadAllBytes(fpath)
</span><span>
</span><span>		front_3bytes = fbytes[:</span><span style="color:#d08770;">3</span><span>]
</span><span>		bom_utf8     = array(byte, (</span><span style="color:#d08770;">0xEF</span><span>, </span><span style="color:#d08770;">0xBB</span><span>, </span><span style="color:#d08770;">0xBF</span><span>))
</span><span>
</span><span>		</span><span style="color:#65737e;"># write bom
</span><span>		</span><span style="color:#b48ead;">unless</span><span> front_3bytes == bom_utf8 :
</span><span>			</span><span style="color:#ebcb8b;">File</span><span>.WriteAllBytes(fpath, bom_utf8 + fbytes)
</span><span>			</span><span style="color:#ebcb8b;">Debug</span><span>.Log(&quot;</span><span style="color:#a3be8c;">append bom complete : ${fpath}</span><span>&quot;)
</span></code></pre>

</div><!-- post -->

<hr />
<script src="https://utteranc.es/client.js" repo="netpyoung/netpyoung.blog.comment" issue-term="url"
  theme="github-light" crossorigin="anonymous" async></script>
<hr />

    </div><!-- /.content -->

    <!-- <div class="footer">
                 </div><!-- /.footer  -->

  </div><!-- /.container -->
</body>

</html>